{% extends "admin/adminmasterlayout.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin-home.css' %}">
{% endblock %}

{% block content %}
    --secondary-color: #64748b;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --dark-color: #1e293b;
    --light-bg: #f8fafc;
    --border-color: #e2e8f0;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1),
      0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
      0 4px 6px -4px rgb(0 0 0 / 0.1);
  }

  .container {
    background-color: var(--light-bg);
    min-height: 100vh;
    padding: 2rem 1rem;
  }
  .page-header h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
  }

  .section-card {
    background: white;
    border: none;
    border-radius: 16px;
    box-shadow: var(--shadow-md);
    margin-bottom: 2rem;
    overflow: hidden;
  }

  .section-header {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-bottom: 2px solid var(--border-color);
    {% comment %} padding: 1.5rem; {% endcomment %}
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--dark-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .form-control,
  .form-select {
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    background-color: #fff;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    outline: none;
  }

  .form-label {
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn {
    border-radius: 5px;
    padding: 10px;
    font-weight: 300;
    border: none;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.1rem;
    font-size: 0.5rem;
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, #3b82f6 100%);
    color: white;
  }

  .btn-primary:hover {
    background: linear-gradient(135deg, #1d4ed8 0%, var(--primary-color) 100%);
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
    color: white;
  }

  .btn-danger {
    background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
    color: white;
  }

  .btn-danger:hover {
    background: linear-gradient(135deg, #dc2626 0%, var(--danger-color) 100%);
    transform: translateY(-1px);
    color: white;
  }

  .btn-secondary {
    background: linear-gradient(
      135deg,
      var(--secondary-color) 0%,
      #475569 100%
    );
    color: white;
  }

  .btn-secondary:hover {
    background: linear-gradient(
      135deg,
      #475569 0%,
      var(--secondary-color) 100%
    );
    transform: translateY(-1px);
    color: white;
  }

  .table {
    border-radius: 5px;
    overflow: hidden;
    background: white;
    margin: 0;
  }

  .table thead th {
    background: linear-gradient(135deg, var(--dark-color) 0%, #334155 100%);
    color: white;
    font-weight: 350;
    border: none;
    padding: 5px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .table tbody tr {
    transition: all 0.2s ease;
  }

  .table tbody tr:hover {
    background-color: #f8fafc;
  }

  .table tbody td {
    padding: 1rem 0.75rem;
    vertical-align: middle;
    border-color: var(--border-color);
    font-size: 0.9rem;
  }

  .img-thumbnail {
    border-radius: 8px;
    border: 2px solid var(--border-color);
    padding: 4px;
    transition: all 0.2s ease;
  }

  .img-thumbnail:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-md);
  }

  .modal-content {
    border: none;
    border-radius: 20px;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }

  .modal-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, #3b82f6 100%);
    color: white;
    padding: 1.5rem;
    border: none;
  }

  .modal-header .modal-title {
    font-weight: 600;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-footer {
    background-color: #f8fafc;
    padding: 1rem;
    border: none;
  }

  .delete-modal .modal-header {
    background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
  }

  .alert {
    border: none;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .alert-success {
    background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    color: #065f46;
    border-left: 4px solid var(--success-color);
  }

  .alert-danger {
    background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
    color: #991b1b;
    border-left: 4px solid var(--danger-color);
  }

  .alert-warning {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    color: #92400e;
    border-left: 4px solid var(--warning-color);
  }

  .alert-info {
    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    color: #1e40af;
    border-left: 4px solid var(--primary-color);
  }

  .action-buttons {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
  }

  .table-responsive {
    border-radius: 12px;
    box-shadow: var(--shadow-sm);
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .file-upload-wrapper {
    position: relative;
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    transition: all 0.2s ease;
  }

  .file-upload-wrapper:hover {
    border-color: var(--primary-color);
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
  }

  .text-truncate-custom {
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  h5 {
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  hr {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, var(--primary-color), transparent);
    margin: 2rem 0;
  }

  /* Font Awesome Icons */
  .fa-plus-circle::before {
    content: "‚ûï";
  }
  .fa-list::before {
    content: "üìã";
  }
  .fa-edit::before {
    content: "‚úèÔ∏è";
  }
  .fa-trash::before {
    content: "üóëÔ∏è";
  }
  .fa-save::before {
    content: "üíæ";
  }
  .fa-check::before {
    content: "‚úÖ";
  }
  .fa-times::before {
    content: "‚ùå";
  }
  .fa-exclamation-triangle::before {
    content: "‚ö†Ô∏è";
  }
  .fa-image::before {
    content: "üñºÔ∏è";
  }
  .fa-heading::before {
    content: "üìù";
  }
  .fa-text-width::before {
    content: "üìÑ";
  }
  .fa-mouse-pointer::before {
    content: "üëÜ";
  }
  .fa-external-link-alt::before {
    content: "üîó";
  }
  .fa-link::before {
    content: "üîó";
  }
  .fa-align-left::before {
    content: "üìù";
  }
  .fa-images::before {
    content: "üñºÔ∏è";
  }
  .fa-check-circle::before {
    content: "‚úÖ";
  }

  @media (max-width: 768px) {
    .container {
      padding: 1rem 0.5rem;
    }

    .form-grid {
      grid-template-columns: 1fr;
    }

    .action-buttons {
      flex-direction: column;
    }

    .table-responsive {
      font-size: 0.8rem;
    }

    .modal-body {
      padding: 1rem;
    }
  }
</style>

<div class="container mt-4">
 <!-- Messages -->
  {% if messages %} {% for message in messages %}
  <div
    class="alert alert-{{ message.tags }} text-center alert-dismissible fade show"
    role="alert"
  >
    <span class="fa-check-circle"></span>
    {{ message }}
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
  {% endfor %} {% endif %}

  <!-- Add New Slider Section -->
  <div class="section-card">
    <div class="section-header">
      <span class="fa-plus-circle"></span>
      Add New Slider
    </div>
    <div style="padding: 1.5rem">
      <form method="POST" enctype="multipart/form-data" class="text-sm">
        {% csrf_token %}
        <div class="form-grid">
          <div class="mb-3">
            <label for="title" class="form-label">
              <span class="fa-heading"></span> Title
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="title"
              name="title"
              required
              placeholder="Enter slider title"
            />
          </div>

          <div class="mb-3">
            <label for="subtitle" class="form-label">
              <span class="fa-text-width"></span> Subtitle
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="subtitle"
              name="subtitle"
              placeholder="Enter subtitle (optional)"
            />
          </div>

          <div class="mb-3">
            <label for="cta_text" class="form-label">
              <span class="fa-mouse-pointer"></span> CTA Text
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="cta_text"
              name="cta_text"
              placeholder="e.g., Learn More, Shop Now"
            />
          </div>

          <div class="mb-3">
            <label for="cta_link" class="form-label">
              <span class="fa-external-link-alt"></span> CTA Link (URL)
            </label>
            <input
              type="url"
              class="form-control form-control-sm"
              id="cta_link"
              name="cta_link"
              placeholder="https://example.com"
            />
          </div>

          <div class="mb-3">
            <label for="cta_internal_page" class="form-label">
              <span class="fa-link"></span> Internal Page
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="cta_internal_page"
              name="cta_internal_page"
              placeholder="e.g., /about, /products"
            />
          </div>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">
            <span class="fa-align-left"></span> Description
          </label>
          <textarea
            class="form-control form-control-sm"
            id="description"
            name="description"
            rows="2"
            placeholder="Enter slider description..."
          ></textarea>
        </div>

        <div class="mb-4">
          <label for="image" class="form-label">
            <span class="fa-image"></span> Image (1920x800px)
          </label>
          <div class="file-upload-wrapper">
            <p style="margin: 0.5rem 0; color: #64748b">
              Click to upload image
            </p>
            <input
              type="file"
              class="form-control form-control-sm"
              id="image"
              name="image"
              required
            />
          </div>
        </div>

        <div style="text-align: right">
          <button type="submit" name="add" class="btn btn-primary btn-sm">
            <span class="fa-save"></span> Save Slider
          </button>
        </div>
      </form>
    </div>
  </div>

  <hr />

  <!-- Sliders List Section -->
  <div class="section-card">
    <div class="section-header">
      <span class="fa-list"></span>
      Sliders List
    </div>
    <div style="padding: 0">
      <div class="table-responsive">
        <table class="table table-bordered table-sm text-sm">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Image</th>
              <th>Title</th>
              <th>Subtitle</th>
              <th>Description</th>
              <th>CTA Text</th>
              <th>CTA Link</th>
              <th>CTA Internal Page</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for slider in sliders %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>
                {% if slider.image %}
                <img
                  src="{{ slider.image.url }}"
                  alt="Slider Image"
                  class="img-thumbnail"
                  style="max-width: 60px"
                />
                {% else %} No Image {% endif %}
              </td>
              <td>{{ slider.title }}</td>
              <td>{{ slider.subtitle }}</td>
              <td class="text-truncate-custom">{{ slider.description }}</td>
              <td>{{ slider.cta_text }}</td>
              <td class="text-truncate-custom">{{ slider.cta_link }}</td>
              <td>{{ slider.cta_internal_page }}</td>
              <td>
                <div class="action-buttons">
                  <button
                    type="button"
                    class="btn btn-primary btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#updateModal{{ slider.id }}"
                  >
                    <i class="fas fa-edit"></i> 
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal{{ slider.id }}"
                  >
                    <i class="fas fa-trash"></i> 
                  </button>
                </div>
              </td>
            </tr>

            <!-- UPDATE MODAL FOR SLIDER -->
            <div
              class="modal fade"
              id="updateModal{{ slider.id }}"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
              tabindex="-1"
              aria-labelledby="updateModalLabel{{ slider.id }}"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5
                      class="modal-title"
                      id="updateModalLabel{{ slider.id }}"
                    >
                      <span class="fa-edit"></span> Update Slider
                    </h5>
                    <button
                      type="button"
                      class="btn-close btn-close-white"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <form
                    method="POST"
                    enctype="multipart/form-data"
                    class="text-sm"
                  >
                    {% csrf_token %}
                    <input
                      type="hidden"
                      name="slider_id"
                      value="{{ slider.id }}"
                    />
                    <div class="modal-body">
                      <div class="form-grid">
                        <div class="mb-3">
                          <label for="title" class="form-label">
                            <span class="fa-heading"></span> Title
                          </label>
                          <input
                            type="text"
                            value="{{ slider.title }}"
                            class="form-control form-control-sm"
                            id="title"
                            name="title"
                            required
                          />
                        </div>

                        <div class="mb-3">
                          <label for="subtitle" class="form-label">
                            <span class="fa-text-width"></span> Subtitle
                          </label>
                          <input
                            type="text"
                            value="{{ slider.subtitle }}"
                            class="form-control form-control-sm"
                            id="subtitle"
                            name="subtitle"
                          />
                        </div>

                        <div class="mb-3">
                          <label for="cta_text" class="form-label">
                            <span class="fa-mouse-pointer"></span> CTA Text
                          </label>
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            value="{{ slider.cta_text }}"
                            id="cta_text"
                            name="cta_text"
                          />
                        </div>

                        <div class="mb-3">
                          <label for="cta_link" class="form-label">
                            <span class="fa-external-link-alt"></span> CTA Link
                            (URL)
                          </label>
                          <input
                            type="url"
                            class="form-control form-control-sm"
                            id="cta_link"
                            value="{{ slider.cta_link }}"
                            name="cta_link"
                          />
                        </div>

                        <div class="mb-3">
                          <label for="cta_internal_page" class="form-label">
                            <span class="fa-link"></span> Internal Page
                          </label>
                          <input
                            type="text"
                            class="form-control form-control-sm"
                            value="{{ slider.cta_internal_page }}"
                            id="cta_internal_page"
                            name="cta_internal_page"
                          />
                        </div>
                      </div>

                      <div class="mb-3">
                        <label for="description" class="form-label">
                          <span class="fa-align-left"></span> Description
                        </label>
                        <textarea
                          class="form-control form-control-sm"
                          id="description"
                          name="description"
                          rows="2"
                        >
{{ slider.description }}</textarea
                        >
                      </div>

                      <div class="mb-3">
                        <label for="image" class="form-label">
                          <span class="fa-image"></span> Image (1920x800px)
                        </label>
                        <div class="file-upload-wrapper">
                          <p style="margin: 0.5rem 0; color: #64748b">
                            Choose new image (optional)
                          </p>
                          <input
                            type="file"
                            class="form-control form-control-sm"
                            id="image"
                            name="image"
                          />
                        </div>
                        {% if slider.image %}
                        <div style="margin-top: 1rem">
                          <small style="color: #64748b">Current image:</small
                          ><br />
                          <img
                            src="{{ slider.image.url }}"
                            alt="Current"
                            class="img-thumbnail"
                            style="max-width: 80px"
                          />
                        </div>
                        {% endif %}
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm"
                        data-bs-dismiss="modal"
                      >
                        <span class="fa-times"></span> Cancel
                      </button>
                      <button
                        type="submit"
                        name="update"
                        class="btn btn-primary btn-sm"
                      >
                        <span class="fa-check"></span> Save Changes
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- DELETE MODAL FOR EACH SLIDER -->
            <div
              class="modal fade delete-modal"
              id="deleteModal{{ slider.id }}"
              data-bs-backdrop="static"
              data-bs-keyboard="false"
              tabindex="-1"
              aria-labelledby="deleteModalLabel{{ slider.id }}"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5
                      class="modal-title"
                      id="deleteModalLabel{{ slider.id }}"
                    >
                      <span class="fa-exclamation-triangle"></span> Confirm
                      Delete
                    </h5>
                    <button
                      type="button"
                      class="btn-close btn-close-white"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <form method="POST">
                    {% csrf_token %}
                    <input
                      type="hidden"
                      name="slider_id"
                      value="{{ slider.id }}"
                    />
                    <div
                      class="modal-body"
                      style="text-align: center; padding: 2rem"
                    >
                      <div style="margin-bottom: 1rem">
                        <span style="font-size: 3rem">üóëÔ∏è</span>
                      </div>
                      <h6 style="margin-bottom: 1rem">
                        Are you sure you want to delete this slider?
                      </h6>
                      <div class="alert alert-warning">
                        <strong>"{{ slider.title }}"</strong><br />
                        <small>This action cannot be undone.</small>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm"
                        data-bs-dismiss="modal"
                      >
                        <span class="fa-times"></span> Cancel
                      </button>
                      <button
                        type="submit"
                        name="delete"
                        class="btn btn-danger btn-sm"
                      >
                        <span class="fa-trash"></span> Delete
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  // Auto-hide alerts after 5 seconds
  setTimeout(function () {
    const alerts = document.querySelectorAll(".alert");
    alerts.forEach(function (alert) {
      if (bootstrap && bootstrap.Alert) {
        const bsAlert = new bootstrap.Alert(alert);
        bsAlert.close();
      }
    });
  }, 5000);
</script>

{% endblock content %}
