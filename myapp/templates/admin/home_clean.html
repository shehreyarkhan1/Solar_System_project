{% extends "admin/adminmasterlayout.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin-home.css' %}">
{% endblock %}

{% block content %}

<div class="slider-management-container">
 <!-- Messages -->
  {% if messages %} {% for message in messages %}
  <div
    class="alert alert-{{ message.tags }} text-center alert-dismissible fade show"
    role="alert"
  >
    <span class="fa-check-circle"></span>
    {{ message }}
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
  {% endfor %} {% endif %}

  <div class="page-header">
    <h1>
      <i class="fas fa-images"></i>
      Homepage Slider Management
    </h1>
  </div>

  <!-- Add New Slider Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-plus-circle"></i>
      Add New Slider
    </div>
    <div class="section-body">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="title" class="form-label">Title</label>
              <input
                type="text"
                class="form-control"
                id="title"
                name="title"
                placeholder="Enter slider title"
                required
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="subtitle" class="form-label">Subtitle</label>
              <input
                type="text"
                class="form-control"
                id="subtitle"
                name="subtitle"
                placeholder="Enter slider subtitle"
              />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="description" class="form-label">Description</label>
          <textarea
            class="form-control"
            id="description"
            name="description"
            rows="3"
            placeholder="Enter slider description"
          ></textarea>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="cta_text" class="form-label">CTA Text</label>
              <input
                type="text"
                class="form-control"
                id="cta_text"
                name="cta_text"
                placeholder="Enter call-to-action text"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="cta_link" class="form-label">CTA Link</label>
              <input
                type="url"
                class="form-control"
                id="cta_link"
                name="cta_link"
                placeholder="Enter external link (optional)"
              />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="image" class="form-label">Slider Image</label>
          <input
            type="file"
            class="form-control"
            id="image"
            name="image"
            accept="image/*"
            required
          />
          <small class="text-muted"
            >Recommended size: 1920x1080px or similar aspect ratio</small
          >
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Add Slider
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Existing Sliders Section -->
  <div class="section-card">
    <div class="section-header">
      <i class="fas fa-images"></i>
      Existing Sliders
    </div>
    <div class="section-body">
      {% if sliders %}
      <div class="row">
        {% for slider in sliders %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="slider-card">
            <div class="slider-card-header">
              <h6 class="slider-card-title">{{ slider.title|default:"No Title" }}</h6>
              <div class="slider-card-actions">
                <button
                  type="button"
                  class="btn btn-sm btn-warning"
                  data-bs-toggle="modal"
                  data-bs-target="#editModal{{ slider.id }}"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-danger"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteModal{{ slider.id }}"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="slider-card-body">
              {% if slider.image %}
              <img
                src="{{ slider.image.url }}"
                alt="{{ slider.title }}"
                class="slider-image-preview"
              />
              {% endif %}
              <div class="slider-info">
                <strong>Subtitle:</strong> {{ slider.subtitle|default:"None" }}
              </div>
              <div class="slider-info">
                <strong>Description:</strong> {{ slider.description|truncatechars:50|default:"None" }}
              </div>
              <div class="slider-actions">
                <small class="text-muted">
                  Created: {{ slider.created_at|date:"M d, Y" }}
                </small>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Modal -->
        <div
          class="modal fade"
          id="editModal{{ slider.id }}"
          tabindex="-1"
          aria-labelledby="editModalLabel{{ slider.id }}"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="slider-modal-header">
                <h5 class="modal-title" id="editModalLabel{{ slider.id }}">
                  <i class="fas fa-edit me-2"></i>Edit Slider
                </h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="slider-modal-content">
                <form
                  method="post"
                  action="{% url 'edit_slider' slider.id %}"
                  enctype="multipart/form-data"
                >
                  {% csrf_token %}
                  <div class="slider-modal-body">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="slider-form-group">
                          <label for="edit_title{{ slider.id }}" class="slider-form-label">Title</label>
                          <input
                            type="text"
                            class="slider-form-input"
                            id="edit_title{{ slider.id }}"
                            name="title"
                            value="{{ slider.title }}"
                            required
                          />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="slider-form-group">
                          <label for="edit_subtitle{{ slider.id }}" class="slider-form-label">Subtitle</label>
                          <input
                            type="text"
                            class="slider-form-input"
                            id="edit_subtitle{{ slider.id }}"
                            name="subtitle"
                            value="{{ slider.subtitle }}"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="slider-form-group">
                      <label for="edit_description{{ slider.id }}" class="slider-form-label">Description</label>
                      <textarea
                        class="slider-form-textarea"
                        id="edit_description{{ slider.id }}"
                        name="description"
                        rows="3"
                      >{{ slider.description }}</textarea>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="slider-form-group">
                          <label for="edit_cta_text{{ slider.id }}" class="slider-form-label">CTA Text</label>
                          <input
                            type="text"
                            class="slider-form-input"
                            id="edit_cta_text{{ slider.id }}"
                            name="cta_text"
                            value="{{ slider.cta_text }}"
                          />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="slider-form-group">
                          <label for="edit_cta_link{{ slider.id }}" class="slider-form-label">CTA Link</label>
                          <input
                            type="url"
                            class="slider-form-input"
                            id="edit_cta_link{{ slider.id }}"
                            name="cta_link"
                            value="{{ slider.cta_link }}"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="slider-form-group">
                      <label for="edit_image{{ slider.id }}" class="slider-form-label">New Image (optional)</label>
                      <input
                        type="file"
                        class="slider-form-file"
                        id="edit_image{{ slider.id }}"
                        name="image"
                        accept="image/*"
                      />
                      {% if slider.image %}
                      <div class="slider-image-upload">
                        <div class="slider-current-image">
                          <small>Current image:</small>
                          <img
                            src="{{ slider.image.url }}"
                            alt="{{ slider.title }}"
                            class="slider-image-thumbnail"
                          />
                        </div>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                  <div class="slider-modal-footer">
                    <button type="button" class="slider-btn slider-btn-secondary" data-bs-dismiss="modal">
                      Cancel
                    </button>
                    <button type="submit" class="slider-btn slider-btn-primary">
                      <i class="fas fa-save me-1"></i>Update Slider
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Delete Modal -->
        <div
          class="modal fade"
          id="deleteModal{{ slider.id }}"
          tabindex="-1"
          aria-labelledby="deleteModalLabel{{ slider.id }}"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="slider-modal-header">
                <h5 class="modal-title" id="deleteModalLabel{{ slider.id }}">
                  <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
                </h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="slider-modal-body">
                <div class="slider-empty-state">
                  <div class="slider-empty-icon">
                    <span>🗑️</span>
                  </div>
                  <h6>Are you sure you want to delete this slider?</h6>
                  <p class="text-muted">
                    <strong>"{{ slider.title|default:"Untitled" }}"</strong> will be
                    permanently removed.
                  </p>
                  <form
                    method="post"
                    action="{% url 'delete_slider' slider.id %}"
                    style="display: inline"
                  >
                    {% csrf_token %}
                    <button type="button" class="slider-btn slider-btn-secondary" data-bs-dismiss="modal">
                      Cancel
                    </button>
                    <button type="submit" class="slider-btn slider-btn-danger">
                      <i class="fas fa-trash me-1"></i>Delete Slider
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <i class="fas fa-images"></i>
        <h5>No Sliders Found</h5>
        <p>Start by adding your first slider using the form above.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock content %}
